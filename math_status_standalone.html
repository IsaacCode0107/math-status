<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸å­¸èª²ç¨‹é€²åº¦è¿½è¹¤ - ç¨ç«‹ç‰ˆæœ¬</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn.success {
            background: #27ae60;
        }
        .btn.success:hover {
            background: #219a52;
        }
        .btn.warning {
            background: #f39c12;
        }
        .btn.warning:hover {
            background: #e67e22;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px 8px;
            text-align: left;
        }
        th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #e8f4f8;
        }
        
        .status-completed { 
            background-color: #d5f4e6; 
            color: #155724;
            font-weight: bold;
        }
        .status-inprogress { 
            background-color: #fff3cd; 
            color: #856404;
            font-weight: bold;
        }
        .status-notstarted { 
            background-color: #f8d7da; 
            color: #721c24;
            font-weight: bold;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        input[type="file"] {
            margin: 10px 0;
        }
        
        .add-row-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        .add-row-form input, .add-row-form select {
            margin: 5px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š æ•¸å­¸èª²ç¨‹é€²åº¦è¿½è¹¤ç³»çµ± - ç¨ç«‹ç‰ˆæœ¬</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            âœ¨ ç„¡éœ€å•Ÿå‹•æœå‹™å™¨ â€¢ è³‡æ–™è‡ªå‹•ä¿å­˜åˆ°ç€è¦½å™¨ â€¢ é‡é–‹æ©Ÿå¾Œè³‡æ–™ä»åœ¨
        </p>
        
        <div class="stats-panel" id="statsPanel">
            <!-- çµ±è¨ˆå¡ç‰‡å°‡ç”± JavaScript ç”Ÿæˆ -->
        </div>
        
        <div class="controls">
            <button class="btn success" onclick="saveData()">ğŸ’¾ ä¿å­˜è³‡æ–™</button>
            <button class="btn" onclick="exportToExcel()">ğŸ“¥ åŒ¯å‡ºExcel</button>
            <button class="btn warning" onclick="toggleAddForm()">â• æ–°å¢èª²ç¨‹</button>
            <button class="btn" onclick="loadSampleData()">ğŸ”„ è¼‰å…¥ç¯„ä¾‹è³‡æ–™</button>
            <button class="btn" onclick="clearAllData()" style="background: #e74c3c;">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
        </div>
        
        <div class="controls">
            <input type="file" id="fileInput" accept=".xlsx,.xls" onchange="importFromExcel(event)">
            <label for="fileInput" class="btn">ğŸ“‚ åŒ¯å…¥Excel</label>
        </div>
        
        <div class="message" id="messageDiv"></div>
        
        <div class="add-row-form" id="addRowForm">
            <h3>æ–°å¢èª²ç¨‹</h3>
            <input type="text" id="newCode" placeholder="èª²ç¨‹ä»£ç¢¼" required>
            <input type="text" id="newName" placeholder="èª²ç¨‹åç¨±" required>
            <input type="text" id="newTime" placeholder="å­¸ç¿’æ™‚æ•¸">
            <select id="newStatus">
                <option value="æœªé–‹å§‹">æœªé–‹å§‹</option>
                <option value="é€²è¡Œä¸­">é€²è¡Œä¸­</option>
                <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
            </select>
            <input type="text" id="newNote" placeholder="å‚™è¨»">
            <input type="date" id="newCompletedDate" placeholder="å®Œæˆæ—¥æœŸ">
            <button class="btn success" onclick="addNewCourse()">ç¢ºèªæ–°å¢</button>
            <button class="btn" onclick="toggleAddForm()">å–æ¶ˆ</button>
        </div>
        
        <table id="courseTable">
            <thead>
                <tr>
                    <th>èª²ç¨‹ä»£ç¢¼</th>
                    <th>èª²ç¨‹åç¨±</th>
                    <th>å­¸ç¿’æ™‚æ•¸</th>
                    <th>ç‹€æ…‹</th>
                    <th>å‚™è¨»</th>
                    <th>å®Œæˆæ—¥æœŸ</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="courseTableBody">
                <!-- èª²ç¨‹è³‡æ–™å°‡ç”± JavaScript ç”Ÿæˆ -->
            </tbody>
        </table>
    </div>

    <script>
        // è³‡æ–™å­˜å„²éµ
        const STORAGE_KEY = 'mathProgressData';
        
        // é è¨­ç¯„ä¾‹è³‡æ–™
        const sampleData = [
            {
                code: 'MATH101',
                name: 'å¾®ç©åˆ†ä¸€',
                time: '36',
                status: 'å·²å®Œæˆ',
                note: 'æœŸæœ«è€ƒ85åˆ†',
                completedDate: '2024-06-15'
            },
            {
                code: 'MATH102',
                name: 'å¾®ç©åˆ†äºŒ',
                time: '36',
                status: 'é€²è¡Œä¸­',
                note: 'ç›®å‰é€²åº¦60%',
                completedDate: ''
            },
            {
                code: 'MATH201',
                name: 'ç·šæ€§ä»£æ•¸',
                time: '30',
                status: 'æœªé–‹å§‹',
                note: 'ä¸‹å­¸æœŸèª²ç¨‹',
                completedDate: ''
            }
        ];
        
        // å¾ç€è¦½å™¨æœ¬åœ°å­˜å„²è¼‰å…¥è³‡æ–™
        function loadData() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                return stored ? JSON.parse(stored) : sampleData;
            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
                return sampleData;
            }
        }
        
        // å„²å­˜è³‡æ–™åˆ°ç€è¦½å™¨æœ¬åœ°å­˜å„²
        function saveDataToStorage(data) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('å„²å­˜è³‡æ–™å¤±æ•—:', error);
                return false;
            }
        }
        
        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(text, isError = false) {
            const messageDiv = document.getElementById('messageDiv');
            messageDiv.className = `message ${isError ? 'error' : 'success'}`;
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
        
        // æ›´æ–°çµ±è¨ˆé¢æ¿
        function updateStats() {
            const data = loadData();
            const total = data.length;
            const completed = data.filter(item => item.status === 'å·²å®Œæˆ').length;
            const inProgress = data.filter(item => item.status === 'é€²è¡Œä¸­').length;
            const notStarted = data.filter(item => item.status === 'æœªé–‹å§‹').length;
            const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const statsPanel = document.getElementById('statsPanel');
            statsPanel.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${total}</div>
                    <div class="stat-label">ç¸½èª²ç¨‹æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${completed}</div>
                    <div class="stat-label">å·²å®Œæˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${inProgress}</div>
                    <div class="stat-label">é€²è¡Œä¸­</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${completionRate}%</div>
                    <div class="stat-label">å®Œæˆç‡</div>
                </div>
            `;
        }
        
        // æ¸²æŸ“èª²ç¨‹è¡¨æ ¼
        function renderTable() {
            const data = loadData();
            const tbody = document.getElementById('courseTableBody');
            
            tbody.innerHTML = data.map((course, index) => `
                <tr>
                    <td>${course.code}</td>
                    <td>${course.name}</td>
                    <td>${course.time}</td>
                    <td class="status-${course.status.toLowerCase().replace('å·²å®Œæˆ', 'completed').replace('é€²è¡Œä¸­', 'inprogress').replace('æœªé–‹å§‹', 'notstarted')}">${course.status}</td>
                    <td>${course.note}</td>
                    <td>${course.completedDate}</td>
                    <td>
                        <button class="btn" onclick="editCourse(${index})" style="font-size: 12px; padding: 4px 8px;">ç·¨è¼¯</button>
                        <button class="btn" onclick="deleteCourse(${index})" style="background: #e74c3c; font-size: 12px; padding: 4px 8px;">åˆªé™¤</button>
                    </td>
                </tr>
            `).join('');
            
            updateStats();
        }
        
        // ä¿å­˜è³‡æ–™
        function saveData() {
            const data = loadData();
            if (saveDataToStorage(data)) {
                showMessage(`âœ… è³‡æ–™å·²ä¿å­˜ï¼å…± ${data.length} ç­†èª²ç¨‹è³‡æ–™`);
            } else {
                showMessage('âŒ è³‡æ–™ä¿å­˜å¤±æ•—ï¼', true);
            }
        }
        
        // è¼‰å…¥ç¯„ä¾‹è³‡æ–™
        function loadSampleData() {
            if (confirm('ç¢ºå®šè¦è¼‰å…¥ç¯„ä¾‹è³‡æ–™å—ï¼Ÿé€™æœƒè¦†è“‹ç¾æœ‰è³‡æ–™ã€‚')) {
                saveDataToStorage(sampleData);
                renderTable();
                showMessage('âœ… ç¯„ä¾‹è³‡æ–™è¼‰å…¥æˆåŠŸï¼');
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰è³‡æ–™
        function clearAllData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                localStorage.removeItem(STORAGE_KEY);
                renderTable();
                showMessage('âœ… æ‰€æœ‰è³‡æ–™å·²æ¸…é™¤ï¼');
            }
        }
        
        // åˆ‡æ›æ–°å¢è¡¨å–®
        function toggleAddForm() {
            const form = document.getElementById('addRowForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
        
        // æ–°å¢èª²ç¨‹
        function addNewCourse() {
            const code = document.getElementById('newCode').value.trim();
            const name = document.getElementById('newName').value.trim();
            const time = document.getElementById('newTime').value.trim();
            const status = document.getElementById('newStatus').value;
            const note = document.getElementById('newNote').value.trim();
            const completedDate = document.getElementById('newCompletedDate').value;
            
            if (!code || !name) {
                showMessage('âŒ èª²ç¨‹ä»£ç¢¼å’Œåç¨±ç‚ºå¿…å¡«é …ï¼', true);
                return;
            }
            
            const data = loadData();
            
            // æª¢æŸ¥ä»£ç¢¼æ˜¯å¦é‡è¤‡
            if (data.some(course => course.code === code)) {
                showMessage('âŒ èª²ç¨‹ä»£ç¢¼å·²å­˜åœ¨ï¼', true);
                return;
            }
            
            const newCourse = { code, name, time, status, note, completedDate };
            data.push(newCourse);
            
            if (saveDataToStorage(data)) {
                renderTable();
                toggleAddForm();
                // æ¸…ç©ºè¡¨å–®
                document.getElementById('newCode').value = '';
                document.getElementById('newName').value = '';
                document.getElementById('newTime').value = '';
                document.getElementById('newStatus').value = 'æœªé–‹å§‹';
                document.getElementById('newNote').value = '';
                document.getElementById('newCompletedDate').value = '';
                showMessage('âœ… èª²ç¨‹æ–°å¢æˆåŠŸï¼');
            } else {
                showMessage('âŒ èª²ç¨‹æ–°å¢å¤±æ•—ï¼', true);
            }
        }
        
        // åˆªé™¤èª²ç¨‹
        function deleteCourse(index) {
            const data = loadData();
            const course = data[index];
            
            if (confirm(`ç¢ºå®šè¦åˆªé™¤èª²ç¨‹ã€Œ${course.name}ã€å—ï¼Ÿ`)) {
                data.splice(index, 1);
                if (saveDataToStorage(data)) {
                    renderTable();
                    showMessage('âœ… èª²ç¨‹åˆªé™¤æˆåŠŸï¼');
                } else {
                    showMessage('âŒ èª²ç¨‹åˆªé™¤å¤±æ•—ï¼', true);
                }
            }
        }
        
        // ç·¨è¼¯èª²ç¨‹ï¼ˆç°¡åŒ–ç‰ˆæœ¬ï¼Œç›´æ¥promptï¼‰
        function editCourse(index) {
            const data = loadData();
            const course = data[index];
            
            const newName = prompt('èª²ç¨‹åç¨±:', course.name);
            if (newName === null) return;
            
            const newTime = prompt('å­¸ç¿’æ™‚æ•¸:', course.time);
            if (newTime === null) return;
            
            const newStatus = prompt('ç‹€æ…‹ (æœªé–‹å§‹/é€²è¡Œä¸­/å·²å®Œæˆ):', course.status);
            if (newStatus === null) return;
            
            const newNote = prompt('å‚™è¨»:', course.note);
            if (newNote === null) return;
            
            const newCompletedDate = prompt('å®Œæˆæ—¥æœŸ (YYYY-MM-DD):', course.completedDate);
            if (newCompletedDate === null) return;
            
            data[index] = {
                ...course,
                name: newName,
                time: newTime,
                status: newStatus,
                note: newNote,
                completedDate: newCompletedDate
            };
            
            if (saveDataToStorage(data)) {
                renderTable();
                showMessage('âœ… èª²ç¨‹æ›´æ–°æˆåŠŸï¼');
            } else {
                showMessage('âŒ èª²ç¨‹æ›´æ–°å¤±æ•—ï¼', true);
            }
        }
        
        // åŒ¯å‡ºåˆ°Excel
        function exportToExcel() {
            const data = loadData();
            const ws = XLSX.utils.json_to_sheet(data.map(course => ({
                'èª²ç¨‹ä»£ç¢¼': course.code,
                'èª²ç¨‹åç¨±': course.name,
                'å­¸ç¿’æ™‚æ•¸': course.time,
                'ç‹€æ…‹': course.status,
                'å‚™è¨»': course.note,
                'å®Œæˆæ—¥æœŸ': course.completedDate
            })));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'èª²ç¨‹é€²åº¦');
            
            const filename = `æ•¸å­¸èª²ç¨‹é€²åº¦_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, filename);
            
            showMessage('âœ… Excelæª”æ¡ˆåŒ¯å‡ºæˆåŠŸï¼');
        }
        
        // å¾ExcelåŒ¯å…¥
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    const courses = jsonData.map(row => ({
                        code: row['èª²ç¨‹ä»£ç¢¼'] || row['code'] || '',
                        name: row['èª²ç¨‹åç¨±'] || row['name'] || '',
                        time: row['å­¸ç¿’æ™‚æ•¸'] || row['time'] || '',
                        status: row['ç‹€æ…‹'] || row['status'] || 'æœªé–‹å§‹',
                        note: row['å‚™è¨»'] || row['note'] || '',
                        completedDate: row['å®Œæˆæ—¥æœŸ'] || row['completedDate'] || ''
                    }));
                    
                    if (courses.length > 0) {
                        if (confirm(`ç™¼ç¾ ${courses.length} ç­†èª²ç¨‹è³‡æ–™ï¼Œç¢ºå®šè¦åŒ¯å…¥å—ï¼Ÿé€™æœƒè¦†è“‹ç¾æœ‰è³‡æ–™ã€‚`)) {
                            if (saveDataToStorage(courses)) {
                                renderTable();
                                showMessage(`âœ… æˆåŠŸåŒ¯å…¥ ${courses.length} ç­†èª²ç¨‹è³‡æ–™ï¼`);
                            } else {
                                showMessage('âŒ è³‡æ–™åŒ¯å…¥å¤±æ•—ï¼', true);
                            }
                        }
                    } else {
                        showMessage('âŒ Excelæª”æ¡ˆä¸­æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„èª²ç¨‹è³‡æ–™ï¼', true);
                    }
                } catch (error) {
                    console.error('åŒ¯å…¥å¤±æ•—:', error);
                    showMessage('âŒ Excelæª”æ¡ˆè®€å–å¤±æ•—ï¼è«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ­£ç¢ºã€‚', true);
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderTable();
            showMessage('âœ… ç³»çµ±è¼‰å…¥å®Œæˆï¼è³‡æ–™å·²å¾ç€è¦½å™¨æœ¬åœ°å­˜å„²è®€å–ã€‚');
        });
        
        // è‡ªå‹•ä¿å­˜åŠŸèƒ½ï¼ˆæ¯5åˆ†é˜è‡ªå‹•ä¿å­˜ä¸€æ¬¡ï¼‰
        setInterval(() => {
            const data = loadData();
            if (data.length > 0) {
                saveDataToStorage(data);
                console.log('è‡ªå‹•ä¿å­˜å®Œæˆ');
            }
        }, 5 * 60 * 1000); // 5åˆ†é˜
        
    </script>
</body>
</html>